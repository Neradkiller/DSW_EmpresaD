
<div class="container" style="
height: 90vh;
width: 85vw;
display: flex;
flex-direction: column;
justify-content: center;
align-items: center;">
  <div *ngIf="op===''" class="container" style="height: 100%;width: 100%;">
    <div class="row" style="height: 50%;">
      <div class="col-8">
        <mat-card class="menu-card" (click)="setOperation('add')">
          <mat-icon class="menu-card-icon">
            add_box
          </mat-icon>
          <h3>Solicitar estudio</h3>
        </mat-card>
      </div>
    </div>
    <div class="row" style="height: 50%;">
      <div class="col">
        <mat-card class="menu-card" (click)="setOperation('upd')">
          <mat-icon class="menu-card-icon">
            update
          </mat-icon>
          <h3>Consulta/Modificar solicitudes</h3>
        </mat-card>
      </div>
    </div>
  </div>
  <div *ngIf="op==='add'"  style="height: 75%;width: 85%;">
    <mat-card style="height: 100%;width: 100%;text-align: center;display: flex;flex-direction: column;">
  <form class="cForm" [formGroup]="addForm"
        *ngIf="opStatus==='S'" (ngSubmit)="serviceInvoke()" novalidate>
    <h4 style="height: fit-content;width: 100%;">Nuevo</h4>
    <div class="cForm-field-row" style="flex: 1;">
      <div class="cForm-field-col">
        <div style="width: 45%;height: 100%;">
          <div class="form-group">
            <label for="marcaSelect">Marca del producto</label>
            <select class="form-control" id="marcaSelect" formControlName="marca">
              <option *ngFor="let Marca of this.marcas" [ngValue]="Marca._id">{{Marca.nombre}}</option>
            </select>
          </div>
        </div>

        <div style="width: 100%;height: 100%;">
          <div class="form-group">
            <label for="tipoADD">Tipo de producto</label>
            <select class="form-control" id="tipoADD" formControlName="tipo">
              <option *ngFor="let Tipo of this.tipos" [ngValue]="Tipo._id">{{Tipo.nombre}}</option>
            </select>
          </div>
        </div>
      </div>

      <div style="width: 45%;height: 100%;">
        <div class="form-group">
          <label for="subcategoriaADD" >Subcategoria del producto:<br><br></label>
          <select class="form-control" id="subcategoriaADD" formControlName="subCategoria">
            <option *ngFor="let SubCategoria of this.subcategorias" [ngValue]="SubCategoria._id">{{SubCategoria.nombre}}</option>
          </select>
        </div>
      </div>


      <div style="width: 45%;height: 100%;">
        <div class="form-group">
          <label for="presentacionADD" >Presentacion del producto:<br><br></label>
          <select class="form-control" id="presentacionADD" formControlName="presentacion">
            <option *ngFor="let presentacion of this.presentaciones" [ngValue]="presentacion._id">{{presentacion.tipo+" "+presentacion.cantidad}}</option>
          </select>
        </div>
      </div>


    </div>
    <div class="cForm-actions">
      <button type="button" class="btn btn-outline-dark" (click)="setOperation('')">Cancelar</button>
      <mat-divider [vertical]="true" [inset]="true"></mat-divider>
      <button type="submit" class="btn btn-primary" style="color: white;">Buscar</button>
    </div>
  </form>
  <div class="cForm" *ngIf="opStatus==='P'">
    <div class="cForm-field-row">
      <div class="cForm-field-col">
        <h3>Procesando operación</h3>
        <div class="text-center" style="flex: 1;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;">
          <div class="spinner-border" style="width: 7.5rem; height: 7.5rem;" role="status">
            <span class="sr-only">Loading...</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="cForm" *ngIf="opStatus==='D'">
    <div class="cForm-field-row">
      <div class="cForm-field-col" style="justify-content:center;align-items: center;">
        <h3>Operación exitosa</h3>
        <mat-icon style="width: 7.5rem; height: 7.5rem;font-size:7.5rem;">
          fact_check
        </mat-icon>
      </div>
    </div>
    <div class="cForm-actions">
      <button type="button" class="btn btn-outline-dark" (click)="setOperation('')">Volver a menú</button>
    </div>
  </div>
  </mat-card>
  </div>
  <div *ngIf="op!=='add' && searchState==='I'" style="height: 75%;width: 75%;">
    <mat-card style="height: 120%;width: 100%;text-align: center;display: flex;flex-direction: column;">
      <h4>Asistente de búsqueda de solicitudes</h4>
      <form [formGroup]="searchForm" (submit)="invokeSearch()" class="cForm">
        <div style="width: 100%;height: 80%; display: flex; flex-direction: row;justify-content: space-around;">
          <div style="width: 45%;height: 100%;">
            <div class="form-group">
              <label for="tipoUPD">Tipo de producto</label>
              <select class="form-control" id="tipoUPD" formControlName="tipo">
                <option *ngFor="let tipo of this.tipos" [ngValue]="tipo._id">{{tipo.nombre}}</option>
              </select>
            </div>
            <div class="form-group">
              <label for="subcategoriaUPD" >Subcategoria del producto:<br><br></label>
              <select class="form-control" id="subcategoriaUPD" formControlName="subCategoria">
                <option *ngFor="let subcategoria of this.subcategorias" [ngValue]="subcategoria._id">{{subcategoria.nombre}}</option>
              </select>
            </div>
          </div>
          <div style="width: 45%;height: 100%;">
            <div class="form-group">
              <label for="marcaSelectUPD">Marca del producto</label>
              <select class="form-control" id="marcaSelectUPD" formControlName="marca">
                <option *ngFor="let marca of this.marcas" [ngValue]="marca._id">{{marca.nombre}}</option>
              </select>
            </div>
            <div class="form-group">
              <label for="presentacionUPD" >Presentacion del producto:<br><br></label>
              <select class="form-control" id="presentacionUPD" formControlName="presentacion">
                <option *ngFor="let presentacion of this.presentaciones" [ngValue]="presentacion._id">{{presentacion.tipo+" "+presentacion.cantidad}}</option>
              </select>
            </div>
            <div class="form-group">
              <label for="reg-date">Fecha de registro:</label>
              <input type="date" class="form-control" formControlName="creado_el" id="reg-date" />
            </div>
            <div class="form-group">
              <label for="reg-date">Fecha de modificacion:</label>
              <input type="date" class="form-control" formControlName="modificado_el" id="modf-date" />
            </div>
          </div>
        </div><br>
        <!--RESTO DE CAMPOS-->
        <div class="cForm-actions">
          <button type="button" class="btn btn-outline-dark" (click)="setOperation('')">Cancelar</button>
          <mat-divider [vertical]="true" [inset]="true"></mat-divider>
          <button type="submit" class="btn btn-primary" style="color: white;">Buscar</button>
        </div>
      </form>
    </mat-card>
  </div>
  <div *ngIf="searchState!=='U' && searchState!=='I'"
       style="width: 100%;height:100%; display: flex; flex-direction: column; justify-content: space-around; align-items: center;">
    <app-data-cliente-table>
      <table mat-table [dataSource]="dataSource" class="mat-elevation-z8" style="flex:1; overflow-y: auto;" *ngIf="searchState==='D'">
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef>Id</th>
          <td mat-cell *matCellDef="let _ID">{{_ID._id}} </td>
        </ng-container>
        <ng-container matColumnDef="selector">
          <th mat-header-cell *matHeaderCellDef>Selección</th>
          <td mat-cell *matCellDef="let element">
            <mat-checkbox [checked]="isSelected(element._id)" (change)="selectSolicitud(element._id,element)">
            </mat-checkbox>
          </td>
        </ng-container>
        <ng-container matColumnDef="estado">
          <th mat-header-cell *matHeaderCellDef>estado</th>
          <td mat-cell *matCellDef="let _ESTADO" >{{_ESTADO.estado}} </td>
        </ng-container>
        <ng-container matColumnDef="creado">
          <th mat-header-cell *matHeaderCellDef>creado</th>
          <td mat-cell *matCellDef="let _creado">{{_creado.creado_el}} </td>
        </ng-container>
        <ng-container matColumnDef="modificado">
          <th mat-header-cell *matHeaderCellDef>modificado</th>
          <td mat-cell *matCellDef="let _modificado">{{_modificado.modificado_el}} </td>
        </ng-container>
        <ng-container matColumnDef="usuario">
          <th mat-header-cell *matHeaderCellDef>usuario</th>
          <td mat-cell *matCellDef="let _usuario">{{_usuario.usuario.nombre}} </td>
        </ng-container>
        <ng-container matColumnDef="Marca">
          <th mat-header-cell *matHeaderCellDef>marca</th>
          <td mat-cell *matCellDef="let _marca">{{_marca.marca.nombre}} </td>
        </ng-container>
        <ng-container matColumnDef="ops">
          <th mat-header-cell *matHeaderCellDef>Operación</th>
          <td mat-cell *matCellDef="let element">
            <div *ngIf="isSelected(element._id)">
              <button  style="background-color: #00d8b4; color:white; margin:0px 5px"
                      mat-mini-fab aria-label="Example icon button with a filter list icon"
                      (click)="openUpdModal()"
                      class="shadow-sm">
                <mat-icon>autorenew</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
      <div class="cForm-field-col" style="justify-content:center;align-items: center; align-self: center;" *ngIf="searchState==='P'">
        <div class="text-center">
          <h3>Procesando búsqueda</h3>
        </div>
        <div class="text-center" style="flex: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;">
          <div class="spinner-border" style="width: 7.5rem; height: 7.5rem;" role="status">
            <span class="sr-only">Loading...</span>
          </div>
        </div>
      </div>
    </app-data-cliente-table>
    <div style="display: flex;flex-direction:row">
      <button mat-raised-button class="shadow-sm" (click)="doSearch()"
              style="color: white;background-color:#00d8b4;">
        <mat-icon>
          search
        </mat-icon>
      </button>
      <mat-divider [vertical]="true" [inset]="true" style="color: transparent;"></mat-divider>
      <button mat-raised-button class="shadow-sm" (click)="setOperation('')"
              style="color: white;background-color:#00d8b4;">Ir a menu principal</button>
    </div>
  </div>
</div>
<app-update-solicitud-dialog
  #updSolicitud
  [_solicitudSelection]="solicitudSelection"
  [_solicitud]="solicitudTarget"
></app-update-solicitud-dialog>
